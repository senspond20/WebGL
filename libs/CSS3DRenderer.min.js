THREE.CSS3DObject=function(e){THREE.Object3D.call(this);this.element=e||document.createElement("div");this.element.style.position="absolute";this.element.style.pointerEvents="auto";this.addEventListener("removed",function(){this.traverse(function(e){if(e.element instanceof Element&&e.element.parentNode!==null){e.element.parentNode.removeChild(e.element)}})})};THREE.CSS3DObject.prototype=Object.assign(Object.create(THREE.Object3D.prototype),{constructor:THREE.CSS3DObject,copy:function(e,t){THREE.Object3D.prototype.copy.call(this,e,t);this.element=e.element.cloneNode(true);return this}});THREE.CSS3DSprite=function(e){THREE.CSS3DObject.call(this,e)};THREE.CSS3DSprite.prototype=Object.create(THREE.CSS3DObject.prototype);THREE.CSS3DSprite.prototype.constructor=THREE.CSS3DSprite;THREE.CSS3DRenderer=function(){var p=this;var r,n;var s,l;var d=new THREE.Matrix4;var m={camera:{fov:0,style:""},objects:new WeakMap};var c=document.createElement("div");c.style.overflow="hidden";this.domElement=c;var v=document.createElement("div");v.style.WebkitTransformStyle="preserve-3d";v.style.transformStyle="preserve-3d";v.style.pointerEvents="none";c.appendChild(v);var f=/Trident/i.test(navigator.userAgent);this.getSize=function(){return{width:r,height:n}};this.setSize=function(e,t){r=e;n=t;s=r/2;l=n/2;c.style.width=e+"px";c.style.height=t+"px";v.style.width=e+"px";v.style.height=t+"px"};function u(e){return Math.abs(e)<1e-10?0:e}function E(e){var t=e.elements;return"matrix3d("+u(t[0])+","+u(-t[1])+","+u(t[2])+","+u(t[3])+","+u(t[4])+","+u(-t[5])+","+u(t[6])+","+u(t[7])+","+u(t[8])+","+u(-t[9])+","+u(t[10])+","+u(t[11])+","+u(t[12])+","+u(-t[13])+","+u(t[14])+","+u(t[15])+")"}function h(e,t){var r=e.elements;var n="matrix3d("+u(r[0])+","+u(r[1])+","+u(r[2])+","+u(r[3])+","+u(-r[4])+","+u(-r[5])+","+u(-r[6])+","+u(-r[7])+","+u(r[8])+","+u(r[9])+","+u(r[10])+","+u(r[11])+","+u(r[12])+","+u(r[13])+","+u(r[14])+","+u(r[15])+")";if(f){return"translate(-50%,-50%)"+"translate("+s+"px,"+l+"px)"+t+n}return"translate(-50%,-50%)"+n}function S(e,t,r,n){if(e instanceof THREE.CSS3DObject){e.onBeforeRender(p,t,r);var a;if(e instanceof THREE.CSS3DSprite){d.copy(r.matrixWorldInverse);d.transpose();d.copyPosition(e.matrixWorld);d.scale(e.scale);d.elements[3]=0;d.elements[7]=0;d.elements[11]=0;d.elements[15]=1;a=h(d,n)}else{a=h(e.matrixWorld,n)}var i=e.element;var o=m.objects.get(e);if(o===undefined||o.style!==a){i.style.WebkitTransform=a;i.style.transform=a;var s={style:a};if(f){s.distanceToCameraSquared=y(r,e)}m.objects.set(e,s)}i.style.display=e.visible?"":"none";if(i.parentNode!==v){v.appendChild(i)}e.onAfterRender(p,t,r)}for(var l=0,c=e.children.length;l<c;l++){S(e.children[l],t,r,n)}}var y=function(){var r=new THREE.Vector3;var n=new THREE.Vector3;return function(e,t){r.setFromMatrixPosition(e.matrixWorld);n.setFromMatrixPosition(t.matrixWorld);return r.distanceToSquared(n)}}();function i(e){var t=[];e.traverse(function(e){if(e instanceof THREE.CSS3DObject)t.push(e)});return t}function x(e){var t=i(e).sort(function(e,t){var r=m.objects.get(e).distanceToCameraSquared;var n=m.objects.get(t).distanceToCameraSquared;return r-n});var r=t.length;for(var n=0,a=t.length;n<a;n++){t[n].element.style.zIndex=r-n}}this.render=function(e,t){var r=t.projectionMatrix.elements[5]*l;if(m.camera.fov!==r){if(t.isPerspectiveCamera){c.style.WebkitPerspective=r+"px";c.style.perspective=r+"px"}else{c.style.WebkitPerspective="";c.style.perspective=""}m.camera.fov=r}if(e.autoUpdate===true)e.updateMatrixWorld();if(t.parent===null)t.updateMatrixWorld();if(t.isOrthographicCamera){var n=-(t.right+t.left)/2;var a=(t.top+t.bottom)/2}var i=t.isOrthographicCamera?"scale("+r+")"+"translate("+u(n)+"px,"+u(a)+"px)"+E(t.matrixWorldInverse):"translateZ("+r+"px)"+E(t.matrixWorldInverse);var o=i+"translate("+s+"px,"+l+"px)";if(m.camera.style!==o&&!f){v.style.WebkitTransform=o;v.style.transform=o;m.camera.style=o}S(e,e,t,i);if(f){x(e)}}};